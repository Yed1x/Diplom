# 3. РАЗРАБОТКА МОДУЛЯ ОБРАБОТКИ ИЗОБРАЖЕНИЙ

## 3.1. Предобработка изображений

В данном разделе описывается разработка модуля предварительной обработки изображений шахматных фигур. Основной целью предобработки является подготовка изображений для эффективного обучения нейронной сети и последующей классификации.

### 3.1.1. Загрузка и валидация изображений

Модуль обработки изображений реализован в файле `chess_piece_classifier.py`. Основные функции включают:

```python
def load_and_preprocess_image(image_path):
    """
    Загрузка и предобработка изображения
    """
    try:
        image = cv2.imread(image_path)
        if image is None:
            raise ValueError("Не удалось загрузить изображение")
        
        # Конвертация в RGB
        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
        
        # Изменение размера
        image = cv2.resize(image, (224, 224))
        
        return image
    except Exception as e:
        logger.error(f"Ошибка при обработке изображения {image_path}: {str(e)}")
        raise
```

### 3.1.2. Нормализация данных

Для улучшения качества обучения модели применяется нормализация данных:

```python
def normalize_image(image):
    """
    Нормализация значений пикселей
    """
    return image / 255.0
```

## 3.2. Аугментация данных

Для увеличения размера обучающей выборки и улучшения обобщающей способности модели применяются различные методы аугментации данных.

### 3.2.1. Методы аугментации

Реализованы следующие методы аугментации:
- Поворот изображения
- Изменение яркости и контраста
- Горизонтальное отражение
- Добавление шума

Пример реализации:

```python
def augment_image(image):
    """
    Применение аугментации к изображению
    """
    augmented = image.copy()
    
    # Случайный поворот
    angle = np.random.uniform(-20, 20)
    augmented = rotate_image(augmented, angle)
    
    # Изменение яркости
    brightness = np.random.uniform(0.8, 1.2)
    augmented = adjust_brightness(augmented, brightness)
    
    return augmented
```

### 3.2.2. Визуализация результатов аугментации

Для проверки качества аугментации созданы визуальные примеры:
- `augmentation_samples_pawn.png`
- `augmentation_samples_rook.png`
- `augmentation_samples_knight.png`
- `augmentation_samples_bishop.png`
- `augmentation_samples_queen.png`

## 3.3. Нормализация данных

### 3.3.1. Стандартизация размеров

Все изображения приводятся к единому размеру 224x224 пикселей, что соответствует требованиям модели EfficientNetB0.

### 3.3.2. Балансировка датасета

Для обеспечения равномерного распределения классов применяется балансировка датасета:

```python
def balance_dataset(dataset_path):
    """
    Балансировка датасета по классам
    """
    class_counts = count_images_per_class(dataset_path)
    min_count = min(class_counts.values())
    
    for class_name in class_counts:
        if class_counts[class_name] > min_count:
            remove_excess_images(dataset_path, class_name, min_count)
```

## 3.4. Выводы по разделу

В результате разработки модуля обработки изображений были достигнуты следующие результаты:

1. Создан надежный механизм загрузки и валидации изображений
2. Реализованы эффективные методы аугментации данных
3. Разработана система нормализации и балансировки датасета
4. Обеспечена совместимость с архитектурой нейронной сети
5. Создана система логирования для отслеживания процесса обработки

Модуль обработки изображений успешно интегрирован в общую архитектуру системы и обеспечивает качественную подготовку данных для обучения и классификации. 